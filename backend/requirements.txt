# requirements.txt
# ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Python Ø¨Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± Backend

fastapi==0.104.1
uvicorn[standard]==0.24.0
websockets==12.0
pydantic==2.5.0
psutil==5.9.6
python-multipart==0.0.6
jinja2==3.1.2
python-json-logger==2.0.7

# Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ù‡ØªØ±
orjson==3.9.10
httptools==0.6.1
uvloop==0.19.0

# Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯
gunicorn==21.2.0

---

# docker-compose.yml
# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¨Ø§ Docker

version: '3.8'

services:
  backend:
    build: .
    ports:
      - "8000:8000"
    environment:
      - ENV=production
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    ports:
      - "3000:3000"
    depends_on:
      - backend
    restart: unless-stopped

---

# Dockerfile
# Ø¨Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± Backend

FROM python:3.11-slim

WORKDIR /app

# Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Ú©Ù¾ÛŒ requirements
COPY requirements.txt .

# Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Python
RUN pip install --no-cache-dir -r requirements.txt

# Ú©Ù¾ÛŒ Ú©Ø¯
COPY . .

# Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ logs
RUN mkdir -p logs

# ØªÙ†Ø¸ÛŒÙ… port
EXPOSE 8000

# Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ±
CMD ["uvicorn", "backend_server:backend.app", "--host", "0.0.0.0", "--port", "8000"]

---

# Dockerfile.frontend
# Ø¨Ø±Ø§ÛŒ React Frontend

FROM node:18-alpine

WORKDIR /app

# Ú©Ù¾ÛŒ package files
COPY package*.json ./

# Ù†ØµØ¨ dependencies
RUN npm ci --only=production

# Ú©Ù¾ÛŒ Ú©Ø¯
COPY . .

# build
RUN npm run build

# Ù†ØµØ¨ serve
RUN npm install -g serve

# ØªÙ†Ø¸ÛŒÙ… port
EXPOSE 3000

# Ø§Ø¬Ø±Ø§ÛŒ frontend
CMD ["serve", "-s", "build", "-l", "3000"]

---

# start_complete_system.sh
#!/bin/bash
# Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…

set -e

# Ø±Ù†Ú¯â€ŒÙ‡Ø§
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
NC='\033[0m'

echo -e "${PURPLE}âš–ï¸  Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø­Ù‚ÙˆÙ‚ÛŒ ÙØ§Ø±Ø³ÛŒ${NC}"
echo "=============================================================="

# ØªØ§Ø¨Ø¹â€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ
print_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

print_error() {
    echo -e "${RED}âŒ $1${NC}"
}

print_info() {
    echo -e "${BLUE}â„¹ï¸  $1${NC}"
}

print_step() {
    echo -e "${YELLOW}ðŸ”§ $1${NC}"
}

# Ø¨Ø±Ø±Ø³ÛŒ Python
check_python() {
    if command -v python3 &> /dev/null; then
        PYTHON_VERSION=$(python3 --version)
        print_success "Python Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª: $PYTHON_VERSION"
        return 0
    else
        print_error "Python 3 ÛŒØ§ÙØª Ù†Ø´Ø¯"
        return 1
    fi
}

# Ø¨Ø±Ø±Ø³ÛŒ Node.js
check_nodejs() {
    if command -v node &> /dev/null; then
        NODE_VERSION=$(node --version)
        print_success "Node.js Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª: $NODE_VERSION"
        return 0
    else
        print_error "Node.js ÛŒØ§ÙØª Ù†Ø´Ø¯"
        return 1
    fi
}

# Ù†ØµØ¨ backend
setup_backend() {
    print_step "Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Backend Server..."
    
    # Ø§ÛŒØ¬Ø§Ø¯ virtual environment
    if [ ! -d "venv" ]; then
        python3 -m venv venv
        print_success "Virtual environment Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
    fi
    
    # ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ virtual environment
    source venv/bin/activate
    
    # Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
    pip install --upgrade pip
    
    if [ -f "requirements.txt" ]; then
        pip install -r requirements.txt
        print_success "ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Backend Ù†ØµØ¨ Ø´Ø¯Ù†Ø¯"
    else
        print_info "Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡..."
        pip install fastapi uvicorn[standard] websockets pydantic psutil python-multipart
        
        # Ø§ÛŒØ¬Ø§Ø¯ requirements.txt
        pip freeze > requirements.txt
        print_success "requirements.txt Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯"
    fi
}

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ frontend
setup_frontend() {
    print_step "Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Frontend Dashboard..."
    
    if [ -d "persian-legal-ai-dashboard" ]; then
        cd persian-legal-ai-dashboard
        
        # Ù†ØµØ¨ dependencies
        if [ ! -d "node_modules" ]; then
            npm install
            print_success "ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Frontend Ù†ØµØ¨ Ø´Ø¯Ù†Ø¯"
        fi
        
        cd ..
    else
        print_error "Ù¾ÙˆØ´Ù‡ frontend ÛŒØ§ÙØª Ù†Ø´Ø¯"
        print_info "Ø§Ø¨ØªØ¯Ø§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù†ØµØ¨ frontend Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯"
    fi
}

# Ø§Ø¬Ø±Ø§ÛŒ Backend
start_backend() {
    print_step "Ø´Ø±ÙˆØ¹ Backend Server..."
    
    # ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ virtual environment
    source venv/bin/activate
    
    # Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆØ± Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
    python backend_server.py &
    BACKEND_PID=$!
    
    echo $BACKEND_PID > backend.pid
    print_success "Backend Server Ø´Ø±ÙˆØ¹ Ø´Ø¯ (PID: $BACKEND_PID)"
    
    # Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
    sleep 3
    
    # Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª
    if curl -s http://localhost:8000/ > /dev/null; then
        print_success "Backend Ø¯Ø± http://localhost:8000 ÙØ¹Ø§Ù„ Ø§Ø³Øª"
    else
        print_error "Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Backend"
        return 1
    fi
}

# Ø§Ø¬Ø±Ø§ÛŒ Frontend
start_frontend() {
    print_step "Ø´Ø±ÙˆØ¹ Frontend Dashboard..."
    
    if [ -d "persian-legal-ai-dashboard" ]; then
        cd persian-legal-ai-dashboard
        
        # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
        npm start &
        FRONTEND_PID=$!
        
        echo $FRONTEND_PID > ../frontend.pid
        print_success "Frontend Ø´Ø±ÙˆØ¹ Ø´Ø¯ (PID: $FRONTEND_PID)"
        
        cd ..
        
        # Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ
        sleep 10
        
        print_success "Dashboard Ø¯Ø± http://localhost:3000 ÙØ¹Ø§Ù„ Ø§Ø³Øª"
    else
        print_error "Ù¾ÙˆØ´Ù‡ frontend ÛŒØ§ÙØª Ù†Ø´Ø¯"
        return 1
    fi
}

# ØªÙˆÙ‚Ù Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
stop_services() {
    print_step "ØªÙˆÙ‚Ù Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§..."
    
    if [ -f "backend.pid" ]; then
        BACKEND_PID=$(cat backend.pid)
        kill $BACKEND_PID 2>/dev/null || true
        rm backend.pid
        print_success "Backend Ù…ØªÙˆÙ‚Ù Ø´Ø¯"
    fi
    
    if [ -f "frontend.pid" ]; then
        FRONTEND_PID=$(cat frontend.pid)
        kill $FRONTEND_PID 2>/dev/null || true
        rm frontend.pid
        print_success "Frontend Ù…ØªÙˆÙ‚Ù Ø´Ø¯"
    fi
}

# Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª
show_status() {
    echo ""
    echo -e "${PURPLE}ðŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒØ³ØªÙ…:${NC}"
    echo "------------------------"
    
    # Ø¨Ø±Ø±Ø³ÛŒ Backend
    if curl -s http://localhost:8000/ > /dev/null; then
        echo -e "${GREEN}âœ… Backend: ÙØ¹Ø§Ù„${NC} - http://localhost:8000"
        echo -e "${BLUE}ðŸ“š API Docs:${NC} http://localhost:8000/docs"
    else
        echo -e "${RED}âŒ Backend: ØºÛŒØ±ÙØ¹Ø§Ù„${NC}"
    fi
    
    # Ø¨Ø±Ø±Ø³ÛŒ Frontend
    if curl -s http://localhost:3000/ > /dev/null; then
        echo -e "${GREEN}âœ… Frontend: ÙØ¹Ø§Ù„${NC} - http://localhost:3000"
    else
        echo -e "${RED}âŒ Frontend: ØºÛŒØ±ÙØ¹Ø§Ù„${NC}"
    fi
    
    echo "------------------------"
}

# Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
main_menu() {
    while true; do
        echo ""
        echo -e "${PURPLE}Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù…Ù„ÛŒØ§Øª:${NC}"
        echo "1. Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…"
        echo "2. Ø´Ø±ÙˆØ¹ ÙÙ‚Ø· Backend"
        echo "3. Ø´Ø±ÙˆØ¹ ÙÙ‚Ø· Frontend"
        echo "4. ØªÙˆÙ‚Ù Ù‡Ù…Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§"
        echo "5. Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª"
        echo "6. Ø®Ø±ÙˆØ¬"
        echo ""
        
        read -p "Ø´Ù…Ø§Ø±Ù‡ Ø¹Ù…Ù„ÛŒØ§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯: " choice
        
        case $choice in
            1)
                print_info "Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ…..."
                setup_backend
                setup_frontend
                start_backend
                start_frontend
                show_status
                
                echo ""
                echo -e "${GREEN}ðŸŽ‰ Ø³ÛŒØ³ØªÙ… Ú©Ø§Ù…Ù„Ø§Ù‹ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯!${NC}"
                echo -e "${BLUE}ðŸ“Š Dashboard:${NC} http://localhost:3000"
                echo -e "${BLUE}ðŸ“š API:${NC} http://localhost:8000"
                echo ""
                echo "Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ Ctrl+C Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯"
                ;;
            2)
                setup_backend
                start_backend
                ;;
            3)
                setup_frontend
                start_frontend
                ;;
            4)
                stop_services
                ;;
            5)
                show_status
                ;;
            6)
                stop_services
                print_info "Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡"
                exit 0
                ;;
            *)
                print_error "Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø§Ù…Ø¹ØªØ¨Ø±"
                ;;
        esac
    done
}

# signal handler Ø¨Ø±Ø§ÛŒ ØªÙˆÙ‚Ù graceful
cleanup() {
    echo ""
    print_info "Ø¯Ø±ÛŒØ§ÙØª Ø³ÛŒÚ¯Ù†Ø§Ù„ ØªÙˆÙ‚Ù..."
    stop_services
    exit 0
}

trap cleanup SIGINT SIGTERM

# Ø´Ø±ÙˆØ¹ Ø§ØµÙ„ÛŒ
main() {
    # Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§
    if ! check_python; then
        print_error "Ù„Ø·ÙØ§Ù‹ Python 3.8+ Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯"
        exit 1
    fi
    
    if ! check_nodejs; then
        print_error "Ù„Ø·ÙØ§Ù‹ Node.js 16+ Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯"
        exit 1
    fi
    
    # Ø§Ø¬Ø±Ø§ÛŒ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
    main_menu
}

# Ø§Ø¬Ø±Ø§ÛŒ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
main "$@"

---

# setup_development.sh
#!/bin/bash
# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡

echo "ðŸ”§ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡"

# Ø§ÛŒØ¬Ø§Ø¯ Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ù…Ù„ Ù¾Ø±ÙˆÚ˜Ù‡
mkdir -p {backend,frontend,docs,tests,scripts,configs}

# Backend setup
cd backend
python3 -m venv venv
source venv/bin/activate
pip install fastapi uvicorn[standard] websockets pydantic psutil pytest black isort
pip freeze > requirements.txt

# Frontend setup
cd ../frontend
npx create-react-app . --template typescript
npm install recharts lucide-react tailwindcss

# Development tools
cd ..
echo "node_modules/" > .gitignore
echo "venv/" >> .gitignore
echo "*.pyc" >> .gitignore
echo "__pycache__/" >> .gitignore
echo ".env" >> .gitignore

echo "âœ… Ù…Ø­ÛŒØ· ØªÙˆØ³Ø¹Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯"

---

# production_deploy.sh
#!/bin/bash
# Ø§Ø³Ú©Ø±ÛŒÙ¾Øª deployment ØªÙˆÙ„ÛŒØ¯

echo "ðŸš€ Ø´Ø±ÙˆØ¹ deployment ØªÙˆÙ„ÛŒØ¯"

# Build frontend
cd frontend
npm run build

# Setup nginx config
sudo tee /etc/nginx/sites-available/persian-ai << 'EOF'
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        root /var/www/persian-ai/frontend/build;
        try_files $uri $uri/ /index.html;
    }
    
    location /api {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /ws {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
EOF

# Enable site
sudo ln -sf /etc/nginx/sites-available/persian-ai /etc/nginx/sites-enabled/
sudo systemctl reload nginx

# Setup systemd service
sudo tee /etc/systemd/system/persian-ai-backend.service << 'EOF'
[Unit]
Description=Persian AI Backend
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/persian-ai/backend
Environment=PATH=/var/www/persian-ai/backend/venv/bin
ExecStart=/var/www/persian-ai/backend/venv/bin/python backend_server.py
Restart=always

[Install]
WantedBy=multi-user.target
EOF

sudo systemctl enable persian-ai-backend
sudo systemctl start persian-ai-backend

echo "âœ… Deployment ØªÙˆÙ„ÛŒØ¯ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯"